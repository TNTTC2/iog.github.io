<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>iPhoneOS 1 - Final Fix</title>
    <style>
        :root {
            --dock-height: 90px;
            --home-area-height: 70px;
            --status-bar-height: 20px;
            --system-font: "Helvetica Neue", Helvetica, Arial, sans-serif;
            --stripe-bg: repeating-linear-gradient(0deg, #c5ccd4, #c5ccd4 1px, #cbd2d8 1px, #cbd2d8 2px);
            --blue-header: linear-gradient(#6d8fb3, #466e99 50%, #365e8d 51%, #315783);
            --black-header: linear-gradient(#444, #222 50%, #111 51%, #000);
            --grey-header: linear-gradient(#cdcdcd, #9c9c9c);
        }

        body {
            margin: 0; padding: 0; background-color: #000; height: 100vh;
            display: flex; flex-direction: column; overflow: hidden;
            font-family: var(--system-font); color: black;
            user-select: none; -webkit-user-select: none;
            overscroll-behavior: none;
        }

        /* --- UI Components --- */
        .status-bar {
            height: var(--status-bar-height); background: linear-gradient(to bottom, #666 0%, #333 50%, #000 51%, #000 100%);
            display: flex; justify-content: space-between; align-items: center; padding: 0 6px;
            font-size: 12px; font-weight: bold; color: white; z-index: 1000; flex-shrink: 0;
        }

        .app-window {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: #fff; z-index: 600; display: none; flex-direction: column;
        }
        .app-opening { animation: zoomIn 0.25s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; }
        .app-closing { animation: zoomOut 0.25s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; pointer-events: none; }

        @keyframes zoomIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes zoomOut { from { transform: scale(1); opacity: 1; } to { transform: scale(0.8); opacity: 0; } }

        /* Multitasking Tray */
        #multitasking-tray {
            position: absolute;
            bottom: var(--home-area-height); 
            left: 0; width: 100%; height: 95px;
            background: url('https://www.transparenttextures.com/patterns/dark-denim-3.png'), #222;
            z-index: 2000; display: none; align-items: center; justify-content: flex-start;
            padding: 0 10px; box-sizing: border-box; overflow-x: auto;
            border-top: 1px solid #555; border-bottom: 1px solid #000;
            animation: slideUp 0.3s ease-out;
            box-shadow: 0 -5px 10px rgba(0,0,0,0.5);
        }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        
        .tray-icon {
            width: 58px; height: 58px; margin-right: 15px; flex-shrink: 0;
            display: flex; flex-direction: column; align-items: center; cursor: pointer;
        }

        /* Custom Popup (iOS 1 Style) */
        #custom-alert-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.4); z-index: 9999; display: none;
            justify-content: center; align-items: center;
        }
        .ios-alert-box {
            width: 280px;
            background: rgba(10, 25, 50, 0.95); /* Deep Blue/Black Glass */
            border: 2px solid rgba(255,255,255,0.6);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.8);
            display: flex; flex-direction: column; align-items: center;
            padding: 15px; text-align: center; color: white;
            backdrop-filter: blur(5px);
        }
        .alert-title { font-size: 18px; font-weight: bold; margin-bottom: 5px; }
        .alert-msg { font-size: 14px; margin-bottom: 15px; }
        .alert-btn {
            width: 100%; padding: 10px;
            background: linear-gradient(#eee, #ccc);
            border: 1px solid #555; border-radius: 8px;
            color: black; font-weight: bold; font-size: 16px; cursor: pointer;
            margin-top: 5px;
        }
        .alert-btn:active { background: #999; }

        /* Standard Components */
        .nav-bar {
            height: 44px; display: flex; justify-content: center; align-items: center;
            font-weight: bold; font-size: 20px; flex-shrink: 0; position: relative;
            color: #000; text-shadow: 0 1px 0 rgba(255,255,255,0.5); border-bottom: 1px solid #666;
            background: var(--grey-header);
        }
        .nav-bar.blue { background: var(--blue-header); color: white; text-shadow: 0 -1px 0 rgba(0,0,0,0.5); border-color: #2d4f78; }
        .nav-bar.black { background: var(--black-header); color: white; text-shadow: none; border-color: #333; }

        .nav-btn { position: absolute; font-size: 12px; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .nav-btn.left { left: 5px; } .nav-btn.right { right: 5px; }
        .btn-style-default { background: linear-gradient(#f9f9f9, #d0d0d0); border: 1px solid #999; color: black; box-shadow: 0 1px 0 rgba(255,255,255,0.4);}

        .tab-bar {
            height: 49px; background: linear-gradient(to bottom, #2d2d2d, #000);
            display: flex; justify-content: space-around; align-items: center; flex-shrink: 0; border-top: 1px solid #444;
        }
        .tab-item { width: 100%; display: flex; flex-direction: column; align-items: center; color: #999; font-size: 10px; cursor: pointer; padding-top: 2px;}
        .tab-item.active { background: radial-gradient(circle at bottom, rgba(255,255,255,0.15), transparent 70%); color: #fff; }
        .tab-icon { font-size: 24px; margin-bottom: 1px; }

        .list-view { list-style: none; padding: 0; margin: 0; background: white; flex-grow: 1; overflow-y: auto; }
        .list-group-bg { background: var(--stripe-bg); }
        .list-item { padding: 12px 15px; border-bottom: 1px solid #e0e0e0; display: flex; justify-content: space-between; align-items: center; font-size: 18px; font-weight: bold; background: white; color: #000; cursor: pointer; }
        .list-item.group { border-top: 1px solid #ccc; border-bottom: 1px solid #ccc; margin-top: 20px; }
        .list-item:active { background: #027afe; color: white; }

        /* Lock Screen */
        #lock-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: url('https://upload.wikimedia.org/wikipedia/commons/8/8c/Earth_Western_Hemisphere_transparent_background.png') no-repeat center 30%, #000;
            background-size: contain; z-index: 900;
            display: flex; flex-direction: column; align-items: center;
            transition: transform 0.4s ease-out; color: white;
        }
        .lock-time { font-size: 80px; font-weight: 100; margin-top: 15%; line-height: 1; font-family: "Helvetica", sans-serif; letter-spacing: -2px;}
        .lock-date { font-size: 18px; margin-top: 10px; }
        
        /* Slider Fixes */
        .slider-container {
            position: absolute; bottom: 80px; width: 80%; max-width: 300px; height: 50px;
            background: #111; border-radius: 25px; border: 1px solid #444;
            display: flex; align-items: center; overflow: hidden;
            box-shadow: inset 0 5px 10px rgba(0,0,0,1);
            user-select: none; /* Prevent text selection */
        }
        .slider-text { width: 100%; text-align: center; color: #666; font-size: 22px; animation: shine 3s infinite; pointer-events: none;}
        .slider-knob {
            width: 46px; height: 46px; border-radius: 50%;
            background: linear-gradient(to bottom, #eee 0%, #aaa 100%); 
            position: absolute; left: 2px;
            display: flex; justify-content: center; align-items: center; color: #333; font-size: 24px; cursor: pointer;
            box-shadow: 0 0 5px rgba(0,0,0,0.5); z-index: 10;
        }
        @keyframes shine { 0%,100% { color: #555; } 50% { color: #fff; } }

        /* Home & Dock */
        #main-display { flex-grow: 1; position: relative; overflow: hidden; background: #000; }
        #home-screen { width: 100%; height: 100%; display: flex; flex-direction: column; padding-top: 15px; background: #000; }
        .grid-container {
            flex-grow: 1; display: grid; grid-template-columns: repeat(4, 1fr); grid-template-rows: repeat(4, min-content);
            gap: 20px 5px; padding: 0 10px; width: 100%; max-width: 400px; margin: 0 auto;
        }
        .app-icon { display: flex; flex-direction: column; align-items: center; cursor: pointer; }
        .app-icon:active { opacity: 0.7; }
        .icon-box {
            width: 58px; height: 58px; border-radius: 12px; background: #555;
            display: flex; justify-content: center; align-items: center; font-size: 30px;
            position: relative; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.6);
        }
        .icon-box::after {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 50%;
            background: linear-gradient(to bottom, rgba(255,255,255,0.6) 0%, rgba(255,255,255,0.1) 100%);
            pointer-events: none;
        }
        .app-name { font-size: 11px; margin-top: 4px; color: #ddd; text-align: center; font-weight: bold; text-shadow: 0 1px 2px #000; }

        .dock {
            height: var(--dock-height); background: linear-gradient(to bottom, rgba(140,140,140,0.4), rgba(0,0,0,0.9));
            border-top: 1px solid rgba(255,255,255,0.2); display: flex; justify-content: space-evenly; align-items: center;
            position: relative; perspective: 600px; flex-shrink: 0; z-index: 10;
        }
        .dock::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; height: 100%;
            background: linear-gradient(to bottom, #aab 0%, #668 50%, #446 51%, #224 100%);
            transform: rotateX(40deg) scaleY(1.3) translateY(5px); transform-origin: bottom; z-index: -1; opacity: 0.6;
        }

        #home-area {
            height: var(--home-area-height); background: #111; border-top: 1px solid #333;
            display: flex; justify-content: center; align-items: center; flex-shrink: 0;
            position: relative; z-index: 2500;
        }
        .home-button {
            width: 58px; height: 58px; border-radius: 50%; border: 2px solid #222;
            background: radial-gradient(circle at center, #222 0%, #000 100%);
            display: flex; justify-content: center; align-items: center; cursor: pointer;
        }
        .home-button .square { width: 20px; height: 20px; border: 2px solid #777; border-radius: 4px; }
        .home-button:active { background: #111; }

        /* Specific Apps */
        
        /* Clock */
        .timer-picker { flex-grow: 1; display: flex; justify-content: center; align-items: center; background: #fff; flex-direction: column; gap: 20px; }
        .time-inputs { display: flex; gap: 5px; align-items: center; font-size: 20px; }
        .time-col { display: flex; flex-direction: column; align-items: center; }
        .time-label { font-size: 12px; color: #666; font-weight: bold; margin-top: 5px;}
        .time-input { width: 60px; height: 60px; font-size: 30px; text-align: center; border: 1px solid #ccc; border-radius: 10px; background: #eee; -moz-appearance: textfield;}
        .time-input::-webkit-outer-spin-button, .time-input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        .timer-display { font-size: 50px; font-family: monospace; font-weight: bold; display: none; }
        .timer-btn { width: 150px; height: 50px; background: #4cd964; border-radius: 10px; color: white; font-size: 20px; font-weight: bold; border: none; cursor: pointer; }
        .timer-btn.stop { background: #ff3b30; }
        
        /* Stopwatch */
        .stopwatch-display { font-size: 60px; font-family: monospace; text-align: center; margin-top: 50px; font-weight: bold; }
        .stopwatch-controls { display: flex; justify-content: center; gap: 20px; margin-top: 30px; }
        .sw-btn { width: 100px; height: 40px; border-radius: 20px; border: none; font-size: 16px; font-weight: bold; cursor: pointer; color: white;}
        .sw-start { background: #4cd964; }
        .sw-stop { background: #ff3b30; }
        .sw-reset { background: #999; }

        /* Weather */
        .weather-bg { background: linear-gradient(to bottom, #1d3356 0%, #3e6aa8 100%); color: white; flex-grow: 1; display: flex; flex-direction: column; align-items: center; padding-top: 40px; position: relative;}
        .weather-card { width: 100px; background: rgba(0,0,0,0.2); border-radius: 10px; padding: 10px; text-align: center; border: 1px solid rgba(255,255,255,0.2); }
        .yahoo-logo { position: absolute; bottom: 10px; left: 10px; font-size: 10px; opacity: 0.8; font-weight: bold;}
        .city-switch-btn { position: absolute; top: 10px; right: 10px; font-size: 24px; cursor: pointer; opacity: 0.9; z-index: 10; width: 40px; height: 40px; display: flex; justify-content: center; align-items: center;}

        /* Maps */
        .map-wrapper { flex-grow: 1; width: 100%; border: none; background: #eee; }

        /* Others */
        .notes-paper { background: #fdfeb6; flex-grow: 1; padding: 20px 40px 20px 20px; font-family: "Marker Felt", "Comic Sans MS", cursive; font-size: 22px; line-height: 30px; background-image: linear-gradient(#f1f1d4 1px, transparent 1px); background-size: 100% 30px; border: none; outline: none; resize: none; color: #333; }
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); padding: 5px; text-align: center; gap: 1px; background: #ccc; }
        .cal-cell { aspect-ratio: 1/1; background: #fff; display: flex; padding: 2px; font-size: 14px; font-weight: bold; color: #333; }
        .cal-cell.today { background: #000; color: #fff; }
        
        .calc-display { background: #000; color: #fff; font-size: 56px; text-align: right; padding: 10px 20px; height: 90px; font-family: monospace; line-height: 90px;}
        .calc-pad { display: grid; grid-template-columns: repeat(4, 1fr); flex-grow: 1; }
        .calc-btn { background: linear-gradient(#fff, #dcdcdc); border: 1px solid #888; font-size: 26px; font-weight: bold; display: flex; justify-content: center; align-items: center; }
        .calc-btn.op { background: linear-gradient(#f9b33b, #e08f18); color: white; border-color: #ba7410; text-shadow: 0 -1px 0 rgba(0,0,0,0.3);}
        .calc-btn:active { background: #bbb; } .calc-btn.op:active { background: #bf7811; }

        /* Camera & Photos */
        #camera-video { width: 100%; height: 100%; object-fit: cover; }
        .camera-controls { height: 100px; background: url('https://www.transparenttextures.com/patterns/brushed-alum.png'), #111; display: flex; justify-content: center; align-items: center; position: absolute; bottom: 0; width: 100%; z-index: 10;}
        .shutter-btn { width: 60px; height: 60px; border-radius: 50%; background: #ccc; border: 4px solid #444; cursor: pointer; }
        .photo-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 2px; padding: 2px; overflow-y: auto; flex-grow: 1; align-content: flex-start; }
        .photo-thumb { aspect-ratio: 1; background: #ddd; background-size: cover; background-position: center; border: 1px solid #fff; cursor: pointer;}
        .photo-empty-msg { width: 100%; text-align: center; margin-top: 50px; color: #999; grid-column: span 4; display: none;}
        #photo-viewer { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: black; z-index: 2000; flex-direction: column; }
        #viewer-img { flex-grow: 1; width: 100%; height: 100%; object-fit: contain; }

        /* Stocks */
        .stock-row { background: #111; color: white; border-bottom: 1px solid #333; padding: 15px; display: flex; justify-content: space-between; align-items: center; height: 50px; box-sizing: border-box;}
        .stock-val-box { padding: 5px 10px; border-radius: 5px; font-weight: bold; width: 70px; text-align: right; font-size: 14px; text-shadow: 0 -1px 0 rgba(0,0,0,0.3);}
        .bg-green { background: linear-gradient(#4cd964, #3cb04f); } .bg-red { background: linear-gradient(#ff3b30, #c02a21); }

    </style>
</head>
<body>

    <div id="custom-alert-overlay">
        <div class="ios-alert-box">
            <div class="alert-title" id="alert-title">Title</div>
            <div class="alert-msg" id="alert-msg">Message goes here</div>
            <button class="alert-btn" id="alert-btn" onclick="closeAlert()">OK</button>
        </div>
    </div>

    <div class="status-bar">
        <div style="display:flex; gap:5px;"><span>AT&T</span><span>üì∂</span></div>
        <div id="status-clock">9:41 AM</div>
        <div>üîã</div>
    </div>

    <div id="main-display">
        
        <div id="lock-screen">
            <div class="lock-time" id="lock-time">9:41</div>
            <div class="lock-date" id="lock-date">Tuesday, January 9</div>
            <div class="slider-container" id="slider-track">
                <div class="slider-text">slide to unlock</div>
                <div class="slider-knob" id="slider-knob">‚ûú</div>
            </div>
        </div>

        <div id="home-screen">
            <div class="grid-container">
                <div class="app-icon" onclick="openApp('sms')"><div class="icon-box" style="background:#4cd964;">üí¨</div><div class="app-name">Text</div></div>
                <div class="app-icon" onclick="openApp('calendar')">
                    <div class="icon-box" id="calendar-icon-box" style="background:#fff; color:#333; display:block; text-align:center;"></div><div class="app-name">Calendar</div>
                </div>
                <div class="app-icon" onclick="openApp('photos')"><div class="icon-box" style="background:linear-gradient(#add8e6, #fff);">üåª</div><div class="app-name">Photos</div></div>
                <div class="app-icon" onclick="openApp('camera')"><div class="icon-box" style="background:#ccc;">üì∑</div><div class="app-name">Camera</div></div>
                <div class="app-icon" onclick="openApp('youtube')"><div class="icon-box" style="background:#5c3d2e;">üì∫</div><div class="app-name">YouTube</div></div>
                <div class="app-icon" onclick="openApp('stocks')"><div class="icon-box" style="background:#333;">üìà</div><div class="app-name">Stocks</div></div>
                <div class="app-icon" onclick="openApp('maps')"><div class="icon-box" style="background:#f4d03f;">üó∫Ô∏è</div><div class="app-name">Maps</div></div>
                <div class="app-icon" onclick="openApp('weather')"><div class="icon-box" style="background:#2980b9;">‚òÄÔ∏è</div><div class="app-name">Weather</div></div>
                <div class="app-icon" onclick="openApp('clock')"><div class="icon-box" style="background:#000;">‚è∞</div><div class="app-name">Clock</div></div>
                <div class="app-icon" onclick="openApp('calculator')"><div class="icon-box" style="background:#e67e22;">üî¢</div><div class="app-name">Calculator</div></div>
                <div class="app-icon" onclick="openApp('notes')"><div class="icon-box" style="background:#f1c40f;">üìù</div><div class="app-name">Notes</div></div>
                <div class="app-icon" onclick="openApp('settings')"><div class="icon-box" style="background:#7f8c8d;">‚öôÔ∏è</div><div class="app-name">Settings</div></div>
            </div>
            <div class="dock">
                <div class="app-icon" onclick="openApp('phone')"><div class="icon-box" style="background:#2ecc71;">üìû</div><div class="app-name">Phone</div></div>
                <div class="app-icon" onclick="openApp('mail')"><div class="icon-box" style="background:#3498db;">‚úâÔ∏è</div><div class="app-name">Mail</div></div>
                <div class="app-icon" onclick="openApp('safari')"><div class="icon-box" style="background:#3498db;">üß≠</div><div class="app-name">Safari</div></div>
                <div class="app-icon" onclick="openApp('ipod')"><div class="icon-box" style="background:#e67e22;">üéµ</div><div class="app-name">iPod</div></div>
            </div>
        </div>

        <div id="app-camera" class="app-window" style="background:#000;">
            <video id="camera-video" autoplay playsinline muted></video>
            <div class="camera-controls">
                <div class="shutter-btn" onclick="takePhoto()"></div>
            </div>
            <canvas id="camera-canvas" style="display:none;"></canvas>
        </div>

        <div id="app-photos" class="app-window">
            <div class="nav-bar black">Camera Roll</div>
            <div class="photo-grid" id="photo-gallery">
                <div id="photo-empty-msg" class="photo-empty-msg" style="display:block;">No Photos<br>Take some with Camera</div>
            </div>
            <div class="tab-bar">
                <div class="tab-item active"><span class="tab-icon">üñº</span>Photos</div>
                <div class="tab-item"><span class="tab-icon">üìÅ</span>Albums</div>
            </div>
            <div id="photo-viewer">
                <div style="height:44px; background:rgba(0,0,0,0.6); display:flex; align-items:center; justify-content:space-between; padding:0 10px; color:white; position:absolute; top:0; width:100%; box-sizing:border-box;">
                    <div style="font-weight:bold; cursor:pointer;" onclick="closePhotoViewer()">Done</div>
                    <div>Photo</div><div></div>
                </div>
                <img id="viewer-img" src="">
                <div style="height:44px; background:rgba(0,0,0,0.6); position:absolute; bottom:0; width:100%; display:flex; justify-content:space-around; align-items:center; color:white;">
                    <span class="share-btn" onclick="showAlert('Share','Sharing not supported')">üì§</span>
                </div>
            </div>
        </div>

        <div id="app-youtube" class="app-window" style="background:#fff;">
            <div class="nav-bar">YouTube</div>
            <div class="list-view">
                <div class="yt-list-item" onclick="playVideo('VQKMoT-6XSg')">
                    <div class="yt-thumb" style="background: url('https://img.youtube.com/vi/VQKMoT-6XSg/0.jpg') center/cover;"></div>
                    <div class="yt-info">
                        <div class="yt-title">iPhone Unveiling</div>
                        <div class="yt-meta">Steve Jobs ‚Ä¢ 2007</div>
                    </div>
                </div>
                <div class="yt-list-item" onclick="playVideo('MnrJzXM7a6o')">
                    <div class="yt-thumb" style="background: url('https://img.youtube.com/vi/MnrJzXM7a6o/0.jpg') center/cover;"></div>
                    <div class="yt-info">
                        <div class="yt-title">Hello</div>
                        <div class="yt-meta">Apple Commercial</div>
                    </div>
                </div>
            </div>
            <div id="yt-player-container">
                <iframe id="yt-iframe" width="100%" height="100%" src="" frameborder="0" allowfullscreen></iframe>
                <div style="position:absolute; top:10px; right:10px; background:rgba(0,0,0,0.5); color:white; padding:5px 10px; border-radius:5px; cursor:pointer;" onclick="closeVideo()">Done</div>
            </div>
            <div class="tab-bar">
                <div class="tab-item active"><span class="tab-icon">‚òÖ</span>Featured</div>
                <div class="tab-item"><span class="tab-icon">üîç</span>Search</div>
                <div class="tab-item"><span class="tab-icon">...</span>More</div>
            </div>
        </div>

        <div id="app-settings" class="app-window">
            <div class="nav-bar">Settings</div>
            <div class="list-view list-group-bg">
                <div class="list-item group">
                    <span>‚úàÔ∏è Airplane Mode</span>
                    <div style="width:50px;height:24px;border:1px solid #999;border-radius:12px;background:#fff;position:relative;"><div style="width:22px;height:22px;background:white;border:1px solid #999;border-radius:50%;box-shadow:0 1px 2px rgba(0,0,0,0.3);"></div></div>
                </div>
                <div class="list-item"><span>Wi-Fi</span><span class="arrow">Not Connected ></span></div>
                <div class="list-item group"><span>General</span><span class="arrow">></span></div>
                <div class="list-item"><span>Sounds</span><span class="arrow">></span></div>
                <div class="list-item"><span>Brightness</span><span class="arrow">></span></div>
            </div>
        </div>

        <div id="app-maps" class="app-window">
            <div class="nav-bar blue">
                <div class="nav-btn left btn-style-default">Search</div>
                Maps
                <div class="nav-btn right btn-style-default">Directions</div>
            </div>
            <iframe id="map-frame" class="map-wrapper" src=""></iframe>
            <div class="tab-bar">
                <div class="tab-item active"><span class="tab-icon">üîç</span>Search</div>
                <div class="tab-item"><span class="tab-icon">‚Ü±</span>Directions</div>
            </div>
        </div>

        <div id="app-ipod" class="app-window">
            <div class="nav-bar black">Now Playing</div>
            <div style="flex-grow:1; background:#000; color:white; display:flex; flex-direction:column; align-items:center; padding-top:20px;">
                <div style="width:200px; height:200px; background:linear-gradient(#333,#111); border:1px solid #444; display:flex; justify-content:center; align-items:center; font-size:60px; box-shadow:0 5px 15px rgba(255,255,255,0.1);">üéµ</div>
                <div style="text-align:center; margin-top:20px;">
                    <h3 id="ipod-title" style="margin:0;">No Music Selected</h3>
                    <p id="ipod-artist" style="color:#999; margin:5px;">Tap below to import</p>
                </div>
                <label class="ipod-import-btn">
                    Import Audio (MP3/M4A)
                    <input type="file" class="ipod-file-input" accept="audio/*, .m4a" onchange="loadAudio(this)">
                </label>
                <audio id="audio-player" controls style="margin-top:20px; width:80%;"></audio>
            </div>
            <div class="tab-bar">
                <div class="tab-item active"><span class="tab-icon">üéµ</span>Music</div>
                <div class="tab-item"><span class="tab-icon">üé§</span>Artists</div>
                <div class="tab-item"><span class="tab-icon">üíø</span>Albums</div>
                <div class="tab-item"><span class="tab-icon">...</span>More</div>
            </div>
        </div>

        <div id="app-clock" class="app-window">
            <div class="nav-bar black" id="clock-header">World Clock</div>
            
            <div id="clock-view-timer" class="timer-picker" style="display:none;">
                <div class="time-inputs" id="timer-inputs">
                    <div class="time-col">
                        <input type="number" id="timer-h" class="time-input" value="0" min="0" max="23" oninput="this.value=this.value.replace(/[^0-9]/g,'');">
                        <span class="time-label">hours</span>
                    </div>
                    <div class="time-col">
                        <input type="number" id="timer-m" class="time-input" value="1" min="0" max="59" oninput="this.value=this.value.replace(/[^0-9]/g,'');">
                        <span class="time-label">mins</span>
                    </div>
                    <div class="time-col">
                        <input type="number" id="timer-s" class="time-input" value="0" min="0" max="59" oninput="this.value=this.value.replace(/[^0-9]/g,'');">
                        <span class="time-label">secs</span>
                    </div>
                </div>
                <div id="timer-countdown" class="timer-display">00:00:00</div>
                <button class="timer-btn" id="timer-toggle-btn" onclick="toggleTimer()">Start Timer</button>
            </div>

            <div id="clock-view-stopwatch" style="flex-grow:1; display:none; background:#fff; flex-direction:column; padding-top:20px;">
                <div class="stopwatch-display" id="sw-display">00:00.00</div>
                <div class="stopwatch-controls">
                    <button class="sw-btn sw-start" onclick="startStopwatch()">Start</button>
                    <button class="sw-btn sw-stop" onclick="stopStopwatch()">Stop</button>
                    <button class="sw-btn sw-reset" onclick="resetStopwatch()">Reset</button>
                </div>
            </div>

            <div id="clock-view-world" style="flex-grow:1; display:flex; background:#fff; flex-direction:column;">
                <ul class="list-view" id="world-clock-list">
                    </ul>
            </div>

            <div class="tab-bar">
                <div class="tab-item active" id="tab-world" onclick="switchClockTab('world')"><span class="tab-icon">üåç</span>World Clock</div>
                <div class="tab-item"><span class="tab-icon">‚è∞</span>Alarm</div>
                <div class="tab-item" id="tab-stopwatch" onclick="switchClockTab('stopwatch')"><span class="tab-icon">‚è±</span>Stopwatch</div>
                <div class="tab-item" id="tab-timer" onclick="switchClockTab('timer')"><span class="tab-icon">‚è≥</span>Timer</div>
            </div>
        </div>

        <div id="app-settings" class="app-window"><div class="nav-bar">Settings</div><div class="list-view list-group-bg"><div class="list-item group"><span>‚úàÔ∏è Airplane Mode</span></div></div></div>
        <div id="app-calendar" class="app-window"><div class="nav-bar">Calendar</div><div class="cal-grid"><div>S</div><div>M</div><div>T</div><div>W</div><div>T</div><div>F</div><div>S</div><div class="cal-cell today">9</div></div></div>
        <div id="app-notes" class="app-window"><div class="nav-bar">Notes</div><textarea class="notes-paper">Notes...</textarea></div>
        <div id="app-stocks" class="app-window" style="background:#000;"><div class="nav-bar black">Stocks</div><div style="background:#111; color:white;"><div class="stock-row"><div><b>AAPL</b></div><div class="stock-val-box bg-green">+4.1%</div></div></div></div>
        <div id="app-sms" class="app-window"><div class="nav-bar blue">Messages</div></div>
        <div id="app-calculator" class="app-window"><div class="calc-display" id="calc-display">0</div><div class="calc-pad"><div class="calc-btn" onclick="calcInput('7')">7</div><div class="calc-btn" onclick="calcInput('8')">8</div><div class="calc-btn" onclick="calcInput('9')">9</div><div class="calc-btn op" onclick="calcInput('/')">√∑</div><div class="calc-btn" onclick="calcInput('4')">4</div><div class="calc-btn" onclick="calcInput('5')">5</div><div class="calc-btn" onclick="calcInput('6')">6</div><div class="calc-btn op" onclick="calcInput('*')">√ó</div><div class="calc-btn" onclick="calcInput('1')">1</div><div class="calc-btn" onclick="calcInput('2')">2</div><div class="calc-btn" onclick="calcInput('3')">3</div><div class="calc-btn op" onclick="calcInput('-')">-</div><div class="calc-btn" onclick="calcInput('0')">0</div><div class="calc-btn" onclick="calcInput('.')">.</div><div class="calc-btn" onclick="calcInput('C')">C</div><div class="calc-btn op" onclick="calcInput('+')">+</div></div></div>
        <div id="app-safari" class="app-window"><div class="nav-bar">Safari</div><iframe src="https://en.m.wikipedia.org/wiki/IPhone_(1st_generation)"></iframe></div>
        <div id="app-phone" class="app-window"><div class="nav-bar">Phone</div></div>
        <div id="app-mail" class="app-window"><div class="nav-bar blue">Mail</div></div>
        <div id="app-ipod" class="app-window"><div class="nav-bar black">iPod</div></div>
        <div id="app-youtube" class="app-window"><div class="nav-bar">YouTube</div></div>

    </div>

    <div id="multitasking-tray"></div>

    <div id="home-area">
        <div class="home-button" onclick="handleHomeClick()">
            <div class="square"></div>
        </div>
    </div>

    <script>
        // --- 0. Custom Alert System ---
        function showAlert(title, msg, callback) {
            const overlay = document.getElementById('custom-alert-overlay');
            document.getElementById('alert-title').innerText = title || "Alert";
            document.getElementById('alert-msg').innerText = msg || "";
            overlay.style.display = 'flex';
            const btn = document.getElementById('alert-btn');
            btn.onclick = function() {
                closeAlert();
                if (callback) callback();
            };
        }
        function closeAlert() { document.getElementById('custom-alert-overlay').style.display = 'none'; }

        // --- 1. Global State ---
        let currentAppId = null;
        let recentApps = []; // Start empty
        let photoArray = [];
        let currentLocationIndex = 0;
        
        // Locations (Sync with Map & World Clock)
        const locations = [
            { name: "New York", lat: 40.71, lon: -74.01, tz: "America/New_York", bbox: "-74.02,40.69,-73.95,40.73", marker: "40.713,-73.986" },
            { name: "Hong Kong", lat: 22.31, lon: 114.16, tz: "Asia/Hong_Kong", bbox: "114.10,22.20,114.25,22.40", marker: "22.319,114.169" },
            { name: "Tokyo", lat: 35.68, lon: 139.76, tz: "Asia/Tokyo", bbox: "139.70,35.65,139.80,35.75", marker: "35.689,139.691" },
            { name: "London", lat: 51.50, lon: -0.12, tz: "Europe/London", bbox: "-0.15,51.48,-0.08,51.52", marker: "51.507,-0.127" },
            { name: "Taipei", lat: 25.03, lon: 121.56, tz: "Asia/Taipei", bbox: "121.50,25.00,121.60,25.10", marker: "25.033,121.565" },
            { name: "San Francisco", lat: 37.77, lon: -122.41, tz: "America/Los_Angeles", bbox: "-122.45,37.75,-122.38,37.80", marker: "37.774,-122.419" }
        ];

        // --- 2. Home & Multitasking ---
        let lastHomeClick = 0;
        let homeClickTimer = null;

        function handleHomeClick() {
            const tray = document.getElementById('multitasking-tray');
            if (tray.style.display === 'flex') {
                tray.style.display = 'none';
                return;
            }
            const now = Date.now();
            if (now - lastHomeClick < 300) {
                clearTimeout(homeClickTimer);
                toggleMultitasking();
            } else {
                lastHomeClick = now;
                homeClickTimer = setTimeout(() => goHome(), 300);
            }
        }

        function toggleMultitasking() {
            const tray = document.getElementById('multitasking-tray');
            if (tray.style.display === 'flex') {
                tray.style.display = 'none';
            } else {
                renderMultitasking();
                tray.style.display = 'flex';
            }
        }

        function renderMultitasking() {
            const tray = document.getElementById('multitasking-tray');
            tray.innerHTML = '';
            
            const appData = {
                'sms': {icon:'üí¨', bg:'#4cd964'}, 'calendar': {icon:'üìÖ', bg:'#fff'}, 'photos': {icon:'üåª', bg:'#add8e6'},
                'camera': {icon:'üì∑', bg:'#ccc'}, 'youtube': {icon:'üì∫', bg:'#5c3d2e'}, 'stocks': {icon:'üìà', bg:'#333'},
                'maps': {icon:'üó∫Ô∏è', bg:'#f4d03f'}, 'weather': {icon:'‚òÄÔ∏è', bg:'#2980b9'}, 'clock': {icon:'‚è∞', bg:'#000'},
                'calculator': {icon:'üî¢', bg:'#e67e22'}, 'notes': {icon:'üìù', bg:'#f1c40f'}, 'settings': {icon:'‚öôÔ∏è', bg:'#7f8c8d'},
                'phone': {icon:'üìû', bg:'#2ecc71'}, 'mail': {icon:'‚úâÔ∏è', bg:'#3498db'}, 'safari': {icon:'üß≠', bg:'#3498db'}, 'ipod': {icon:'üéµ', bg:'#e67e22'}
            };
            
            // Only render apps that have been opened (not pre-filled)
            [...new Set(recentApps)].forEach(id => {
                const data = appData[id];
                if(data) {
                    const div = document.createElement('div');
                    div.className = 'tray-icon';
                    div.onclick = () => { openApp(id); tray.style.display='none'; };
                    div.innerHTML = `<div class="icon-box" style="background:${data.bg}; color:${id==='calendar'?'#333':'white'}">${data.icon}</div>`;
                    tray.appendChild(div);
                }
            });
        }

        function openApp(id) {
            document.getElementById('multitasking-tray').style.display = 'none';
            if(currentAppId === 'app-' + id) return;
            
            recentApps = [id, ...recentApps.filter(a => a !== id)];

            document.querySelectorAll('.app-window').forEach(el => {
                el.classList.remove('app-opening', 'app-closing');
                if(el.id !== 'app-' + id) el.style.display = 'none';
            });
            
            const app = document.getElementById('app-' + id);
            if(app) {
                app.style.display = 'flex';
                app.style.zIndex = 700;
                app.classList.add('app-opening');
                currentAppId = 'app-' + id;
                
                if(id === 'camera') startCamera(); else stopCamera();
                if(id === 'weather') fetchWeather();
                if(id === 'clock') updateWorldClock();
                if(id === 'maps') updateMap();
            }
        }

        function goHome() {
            if(!currentAppId) return;
            const app = document.getElementById(currentAppId);
            if(app) {
                app.classList.remove('app-opening');
                app.classList.add('app-closing');
                app.addEventListener('animationend', () => {
                    if(app.classList.contains('app-closing')) {
                        app.style.display = 'none';
                        app.classList.remove('app-closing');
                    }
                }, {once: true});
            }
            stopCamera();
            currentAppId = null;
        }

        // --- 3. Clock & Timer & Stopwatch ---
        function updateTime() {
            const now = new Date();
            let h = now.getHours();
            const m = String(now.getMinutes()).padStart(2, '0');
            const ampm = h >= 12 ? 'PM' : 'AM';
            h = h % 12 || 12;
            document.getElementById('status-clock').innerText = `${h}:${m} ${ampm}`;
            document.getElementById('lock-time').innerText = `${h}:${m}`;
            
            const dayNames = ['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT'];
            const iconBox = document.getElementById('calendar-icon-box');
            if(iconBox) iconBox.innerHTML = `<div style="color:#c00; font-size:10px; margin-top:6px; font-weight:bold;">${dayNames[now.getDay()]}</div><div style="font-size:32px; font-weight:bold; line-height:1;">${now.getDate()}</div>`;
        }
        setInterval(updateTime, 1000);
        updateTime();

        function updateWorldClock() {
            const list = document.getElementById('world-clock-list');
            list.innerHTML = '';
            locations.forEach(loc => {
                const now = new Date();
                const timeStr = now.toLocaleTimeString('en-US', { timeZone: loc.tz, hour: 'numeric', minute:'2-digit' });
                const li = document.createElement('li');
                li.className = 'list-item';
                li.innerHTML = `<div>${loc.name}<br><span style="font-size:12px; color:#999;">Today</span></div><div>${timeStr}</div>`;
                list.appendChild(li);
            });
        }
        setInterval(() => { if(currentAppId === 'app-clock') updateWorldClock(); }, 60000);

        function switchClockTab(tab) {
            ['timer', 'world', 'stopwatch'].forEach(t => {
                document.getElementById('clock-view-' + t).style.display = 'none';
                const tabEl = document.getElementById('tab-' + t);
                if(tabEl) tabEl.classList.remove('active');
            });
            document.getElementById('clock-view-' + tab).style.display = (tab==='world')?'flex':'flex';
            document.getElementById('clock-header').innerText = tab.charAt(0).toUpperCase() + tab.slice(1);
            const activeTab = document.getElementById('tab-' + tab);
            if(activeTab) activeTab.classList.add('active');
        }

        function toggleTimer() {
            const btn = document.getElementById('timer-toggle-btn');
            const inputs = document.getElementById('timer-inputs');
            const display = document.getElementById('timer-countdown');

            if(timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
                btn.innerText = "Start Timer";
                btn.classList.remove('stop');
                inputs.style.display = 'flex';
                display.style.display = 'none';
                return;
            }

            const h = parseInt(document.getElementById('timer-h').value) || 0;
            const m = parseInt(document.getElementById('timer-m').value) || 0;
            const s = parseInt(document.getElementById('timer-s').value) || 0;
            if(h === 0 && m === 0 && s === 0) return;
            timerSeconds = (h * 3600) + (m * 60) + s;
            
            inputs.style.display = 'none';
            display.style.display = 'block';
            btn.innerText = "Cancel";
            btn.classList.add('stop');
            
            updateTimerDisplay();
            timerInterval = setInterval(() => {
                timerSeconds--;
                if(timerSeconds <= 0) {
                    clearInterval(timerInterval);
                    timerInterval = null;
                    display.innerText = "Done";
                    btn.innerText = "OK";
                    btn.classList.remove('stop');
                    
                    const isViewingTimer = (currentAppId === 'app-clock' && document.getElementById('clock-view-timer').style.display !== 'none');
                    if(!isViewingTimer) {
                        showAlert("Timer", "Timer has finished!");
                    }
                } else {
                    updateTimerDisplay();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const h = Math.floor(timerSeconds / 3600);
            const m = Math.floor((timerSeconds % 3600) / 60);
            const s = timerSeconds % 60;
            document.getElementById('timer-countdown').innerText = `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
        }

        // Stopwatch
        let swInterval = null;
        let swStartTime = 0;
        let swElapsedTime = 0;
        
        function formatSW(ms) {
            const totalSec = Math.floor(ms / 1000);
            const m = Math.floor(totalSec / 60);
            const s = totalSec % 60;
            const cs = Math.floor((ms % 1000) / 10);
            return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}.${String(cs).padStart(2,'0')}`;
        }
        function startStopwatch() {
            if(!swInterval) {
                swStartTime = Date.now() - swElapsedTime;
                swInterval = setInterval(() => {
                    swElapsedTime = Date.now() - swStartTime;
                    document.getElementById('sw-display').innerText = formatSW(swElapsedTime);
                }, 50);
            }
        }
        function stopStopwatch() {
            if(swInterval) {
                clearInterval(swInterval);
                swInterval = null;
            }
        }
        function resetStopwatch() {
            stopStopwatch();
            swElapsedTime = 0;
            document.getElementById('sw-display').innerText = "00:00.00";
        }

        // --- 4. Weather & Map Sync ---
        function switchLocation() {
            currentLocationIndex = (currentLocationIndex + 1) % locations.length;
            fetchWeather();
            if(currentAppId === 'app-maps') updateMap();
        }

        async function fetchWeather() {
            const loc = locations[currentLocationIndex];
            document.getElementById('weather-city').innerText = loc.name;
            try {
                const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${loc.lat}&longitude=${loc.lon}&current_weather=true&daily=temperature_2m_max,temperature_2m_min&timezone=auto`);
                const data = await res.json();
                const temp = Math.round(data.current_weather.temperature);
                document.getElementById('weather-temp').innerText = temp + '¬∞';
                // Sync World Clock too
                updateWorldClock();
            } catch(e) { console.log(e); }
        }
        
        function updateMap() {
            const loc = locations[currentLocationIndex];
            document.getElementById('map-frame').src = `https://www.openstreetmap.org/export/embed.html?bbox=${loc.bbox}&layer=mapnik&marker=${loc.marker}`;
        }

        // --- 5. Slider Logic ---
        const knob = document.getElementById('slider-knob');
        const track = document.getElementById('slider-track');
        const lockScreen = document.getElementById('lock-screen');
        let isDragging = false, startX = 0;

        knob.addEventListener('mousedown', startDrag);
        knob.addEventListener('touchstart', (e) => startDrag(e.touches[0]));
        function startDrag(e) {
            isDragging = true; startX = e.clientX;
            knob.style.transition = 'none';
            document.addEventListener('mousemove', onDrag);
            document.addEventListener('touchmove', (e) => onDrag(e.touches[0]));
            document.addEventListener('mouseup', endDrag);
            document.addEventListener('touchend', endDrag);
        }
        function onDrag(e) {
            if(!isDragging) return;
            const maxSlide = track.offsetWidth - knob.offsetWidth - 4;
            let move = e.clientX - startX;
            if(move < 0) move = 0;
            if(move > maxSlide) move = maxSlide;
            
            knob.style.transform = `translateX(${move}px)`;
            document.querySelector('.slider-text').style.opacity = 1 - (move / maxSlide);
            
            if(move >= maxSlide * 0.9) unlock();
        }
        function endDrag() {
            isDragging = false;
            document.removeEventListener('mousemove', onDrag);
            document.removeEventListener('touchmove', onDrag);
            if(lockScreen.style.transform !== 'translateY(-100%)') {
                knob.style.transition = 'transform 0.3s';
                knob.style.transform = 'translateX(0px)';
                document.querySelector('.slider-text').style.opacity = 1;
            }
        }
        function unlock() { lockScreen.style.transform = 'translateY(-100%)'; }

        // --- 6. Camera & Photos ---
        let videoStream = null;
        async function startCamera() {
            try {
                if(!videoStream) {
                    videoStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
                    document.getElementById('camera-video').srcObject = videoStream;
                }
            } catch (err) { showAlert("Error", "Camera access denied"); }
        }
        function stopCamera() {
            if(videoStream) {
                videoStream.getTracks().forEach(track => track.stop());
                videoStream = null;
            }
        }
        function takePhoto() {
            const video = document.getElementById('camera-video');
            const canvas = document.getElementById('camera-canvas');
            if(video.videoWidth) {
                canvas.width = video.videoWidth; canvas.height = video.videoHeight;
                canvas.getContext('2d').drawImage(video, 0, 0);
                photoArray.push(canvas.toDataURL('image/png'));
                video.style.opacity = 0; setTimeout(() => video.style.opacity = 1, 100);
                updatePhotosApp();
            }
        }
        function updatePhotosApp() {
            const gallery = document.getElementById('photo-gallery');
            const emptyMsg = document.getElementById('photo-empty-msg');
            gallery.querySelectorAll('.generated-photo').forEach(e => e.remove());
            if (photoArray.length > 0) {
                emptyMsg.style.display = 'none';
                [...photoArray].reverse().forEach(src => {
                    const div = document.createElement('div');
                    div.className = 'photo-thumb generated-photo';
                    div.style.backgroundImage = `url(${src})`;
                    div.onclick = () => viewPhoto(src);
                    gallery.prepend(div);
                });
            } else { emptyMsg.style.display = 'block'; }
        }
        function viewPhoto(src) {
            document.getElementById('viewer-img').src = src;
            currentPhotoBlob = src;
            document.getElementById('photo-viewer').style.display = 'flex';
        }
        function closePhotoViewer() { document.getElementById('photo-viewer').style.display = 'none'; }
        async function sharePhoto() { showAlert("Share", "Sharing not supported"); }

        // --- 7. Others ---
        function loadAudio(input) {
            const file = input.files[0];
            if(file) {
                document.getElementById('audio-player').src = URL.createObjectURL(file);
                document.getElementById('audio-player').play();
                document.getElementById('ipod-title').innerText = file.name;
            }
        }
        function loadUrl() {
            let url = document.getElementById('safari-input').value;
            if(!url.startsWith('http')) url = 'https://' + url;
            document.getElementById('safari-frame').src = url;
        }
        let cVal = '0';
        function calcInput(v) {
            if(v==='C') cVal='0';
            else if(v==='=') { try{cVal=eval(cVal).toString()}catch{cVal='Err'} }
            else { if(cVal==='0') cVal=v; else cVal+=v; }
            document.getElementById('calc-display').innerText = cVal.substring(0,9);
        }

        // Init
        updateWorldClock();
        updateMap();
    </script>
</body>
</html>
