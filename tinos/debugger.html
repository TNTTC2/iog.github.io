<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Root Debugger</title>
    <style>
        :root {
            --bg: #000; --card: #1c1c1e; --primary: #ff3b30; --text: #fff; --code: #32d74b; --accent: #0a84ff;
        }
        body { background: var(--bg); color: var(--text); font-family: -apple-system, sans-serif; margin: 0; display: flex; justify-content: center; }
        .container { width: 100%; max-width: 600px; background: var(--card); min-height: 100vh; display: flex; flex-direction: column; }
        
        /* Tab Bar */
        .nav-tabs { display: flex; background: #121212; border-bottom: 1px solid #2c2c2e; position: sticky; top: 0; z-index: 10; }
        .tab { flex: 1; padding: 15px 5px; text-align: center; font-size: 12px; color: #8e8e93; cursor: pointer; }
        .tab.active { color: var(--text); border-bottom: 2px solid var(--primary); background: var(--card); }

        .content { padding: 20px; flex: 1; display: none; }
        .content.active { display: block; }

        /* ç·¨è¼¯å™¨åˆ†é  (é—œéµæ”¹é€²) */
        .editor-header { color: var(--accent); font-size: 12px; margin-bottom: 5px; font-family: monospace; }
        .main-textarea { width: 100%; height: 250px; background: #000; color: var(--code); border: 1px solid #333; border-radius: 12px; padding: 15px; font-family: monospace; box-sizing: border-box; outline: none; }
        .key-selector { margin-top: 15px; display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .key-btn { background: #2c2c2e; border: 1px solid #444; color: #ccc; padding: 10px; border-radius: 8px; font-size: 11px; cursor: pointer; text-align: left; overflow: hidden; text-overflow: ellipsis; }
        .key-btn.active { border-color: var(--accent); color: var(--accent); background: rgba(10,132,255,0.1); }

        /* Wallpaper ç®¡ç† (ä¸¦æ’è¨­è¨ˆ) */
        .wp-preview-container { display: flex; gap: 15px; justify-content: center; margin-bottom: 20px; }
        .wp-box { flex: 1; background: #000; border-radius: 15px; border: 1px solid #333; overflow: hidden; display: flex; flex-direction: column; align-items: center; padding: 10px; }
        .wp-img { width: 100%; height: 180px; object-fit: cover; border-radius: 10px; background: #222; margin-bottom: 10px; }
        .wp-label { font-size: 12px; font-weight: bold; margin-bottom: 10px; }
        .wp-actions { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; width: 100%; }
        .wp-btn { font-size: 10px; padding: 6px; background: #3a3a3c; border: none; color: #fff; border-radius: 4px; cursor: pointer; }

        /* Apps ç®¡ç† */
        .info-card { background: #2c2c2e; padding: 15px; border-radius: 12px; margin-bottom: 10px; font-size: 13px; }

        /* Footer Actions */
        .footer { padding: 20px; display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; background: #121212; border-top: 1px solid #2c2c2e; }
        .btn { padding: 12px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 14px; text-align: center; }
        .btn-apply { background: #32d74b; color: #000; }
        .btn-reset { background: #3a3a3c; color: #fff; }
        .btn-respring { background: var(--primary); color: #fff; }
    </style>
</head>
<body>

<div class="container">
    <div class="nav-tabs">
        <div class="tab active" onclick="showTab('editor')">ç·¨è¼¯å™¨</div>
        <div class="tab" onclick="showTab('apps')">Appsç®¡ç†</div>
        <div class="tab" onclick="showTab('wallpaper')">Wallpaperç®¡ç†</div>
        <div class="tab" onclick="showTab('menu')">é¸å–®</div>
    </div>

    <div id="editor" class="content active">
        <div class="editor-header" id="current-key-display">KEY: userPasscode</div>
        <textarea id="mainEditor" class="main-textarea" spellcheck="false" oninput="updateTempCache()"></textarea>
        <div class="key-selector" id="keySelector"></div>
    </div>

    <div id="apps" class="content">
        <div class="info-card">ğŸ’¡ æç¤ºï¼šå¦‚éœ€æ’åº Appï¼Œè«‹åœ¨ã€Œç·¨è¼¯å™¨ã€ä¸­åˆ‡æ›è‡³ <b>installedApps</b> éµå€¼ï¼Œç›´æ¥ç§»å‹• JSON æ•¸çµ„å…§çš„ç‰©ä»¶é †åºã€‚</div>
        <div id="appsStatusList"></div>
    </div>

    <div id="wallpaper" class="content">
        <div class="wp-preview-container">
            <div class="wp-box">
                <div class="wp-label">Lock Screen</div>
                <img id="prev-lockWallpaper" class="wp-img">
                <div class="wp-actions">
                    <button class="wp-btn" onclick="wpImport('lockWallpaper')">åŒ¯å…¥</button>
                    <button class="wp-btn" onclick="wpExport('lockWallpaper')">åŒ¯å‡º</button>
                    <button class="wp-btn" onclick="wpLink('lockWallpaper')">é€£çµ</button>
                    <button class="wp-btn" onclick="wpClear('lockWallpaper')">æ¸…é™¤</button>
                </div>
            </div>
            <div class="wp-box">
                <div class="wp-label">Home Screen</div>
                <img id="prev-homeWallpaper" class="wp-img">
                <div class="wp-actions">
                    <button class="wp-btn" onclick="wpImport('homeWallpaper')">åŒ¯å…¥</button>
                    <button class="wp-btn" onclick="wpExport('homeWallpaper')">åŒ¯å‡º</button>
                    <button class="wp-btn" onclick="wpLink('homeWallpaper')">é€£çµ</button>
                    <button class="wp-btn" onclick="wpClear('homeWallpaper')">æ¸…é™¤</button>
                </div>
            </div>
        </div>
        <input type="file" id="wpFileLoader" style="display:none" accept="image/*">
    </div>

    <div id="menu" class="content">
        <div class="info-card" onclick="showTab('editor')">ğŸ› ï¸ ç³»çµ±æ•¸æ“šæ·±åº¦ç·¨è¼¯ (Root Access)</div>
        <div class="info-card" onclick="showTab('apps')">ğŸ“¦ æ‡‰ç”¨ç¨‹å¼åŒ…åºä½èˆ‡ç‹€æ…‹ç®¡ç†</div>
        <div class="info-card" onclick="showTab('wallpaper')">ğŸ–¼ï¸ è˜‹æœé¢¨æ ¼æ¡Œå¸ƒé è¦½èˆ‡ DataURL ç®¡ç†</div>
        <div class="info-card" style="opacity:0.5">âŒ¨ï¸ æŒ‡ä»¤ä¸»æ©Ÿ (é–‹ç™¼ä¸­)</div>
    </div>

    <div class="footer">
        <div class="btn btn-reset" onclick="initRoot()">é‡è¨­</div>
        <div class="btn btn-apply" onclick="saveToSystem()">å¥—ç”¨</div>
        <div class="btn btn-respring" onclick="location.href='./install.html'">é‡åˆ·</div>
    </div>
</div>

<script>
    const KEYS = ['userPasscode', 'installedApps', 'currentTheme', 'homeWallpaper', 'lockWallpaper', 'userPhotos'];
    let tempCache = {};
    let activeKey = 'userPasscode';

    // åˆå§‹åŒ–èˆ‡è®€å–
    function initRoot() {
        KEYS.forEach(key => {
            tempCache[key] = localStorage.getItem(key) || "";
        });
        renderKeySelector();
        loadKeyToEditor(activeKey);
        updateWallpaperPreviews();
        renderAppsStatus();
    }

    // ç·¨è¼¯å™¨é‚è¼¯
    function renderKeySelector() {
        const container = document.getElementById('keySelector');
        container.innerHTML = '';
        KEYS.forEach(key => {
            const btn = document.createElement('div');
            btn.className = `key-btn ${key === activeKey ? 'active' : ''}`;
            btn.innerText = key;
            btn.onclick = () => {
                activeKey = key;
                renderKeySelector();
                loadKeyToEditor(key);
                document.getElementById('current-key-display').innerText = `KEY: ${key}`;
            };
            container.appendChild(btn);
        });
    }

    function loadKeyToEditor(key) {
        document.getElementById('mainEditor').value = tempCache[key];
    }

    function updateTempCache() {
        tempCache[activeKey] = document.getElementById('mainEditor').value;
    }

    function saveToSystem() {
        if(!confirm("å°‡æš«å­˜æ•¸æ“šå¯«å…¥ç³»çµ±å¯¦é«”å­˜å–å±¤ï¼Ÿ")) return;
        Object.keys(tempCache).forEach(key => {
            localStorage.setItem(key, tempCache[key]);
        });
        alert("âœ… æ•¸æ“šå·²æ›´æ–°");
        updateWallpaperPreviews();
        renderAppsStatus();
    }

    // Wallpaper åŠŸèƒ½
    function updateWallpaperPreviews() {
        ['homeWallpaper', 'lockWallpaper'].forEach(key => {
            const data = localStorage.getItem(key);
            const img = document.getElementById(`prev-${key}`);
            img.src = data || "";
            img.alt = data ? "" : "No Image";
        });
    }

    function wpImport(key) {
        const loader = document.getElementById('wpFileLoader');
        loader.onchange = e => {
            const file = e.target.files[0];
            const reader = new FileReader();
            reader.onload = event => {
                tempCache[key] = event.target.result;
                localStorage.setItem(key, event.target.result);
                updateWallpaperPreviews();
                if(activeKey === key) loadKeyToEditor(key);
            };
            reader.readAsDataURL(file);
        };
        loader.click();
    }

    function wpExport(key) {
        const data = localStorage.getItem(key);
        if(!data) return alert("ç„¡æ•¸æ“šå¯åŒ¯å‡º");
        const link = document.createElement('a');
        link.href = data;
        link.download = `${key}_backup.png`;
        link.click();
    }

    function wpLink(key) {
        const data = localStorage.getItem(key) || "Empty";
        const newUrl = prompt(`ç·¨è¼¯ ${key} çš„é€£çµ (æ”¯æ´ DataURL):`, data);
        if(newUrl !== null) {
            localStorage.setItem(key, newUrl);
            tempCache[key] = newUrl;
            updateWallpaperPreviews();
            if(activeKey === key) loadKeyToEditor(key);
        }
    }

    function wpClear(key) {
        if(confirm(`ç¢ºå®šæ¸…é™¤ ${key}ï¼Ÿ`)) {
            localStorage.removeItem(key);
            tempCache[key] = "";
            updateWallpaperPreviews();
            if(activeKey === key) loadKeyToEditor(key);
        }
    }

    // Apps ç®¡ç†
    function renderAppsStatus() {
        const apps = JSON.parse(localStorage.getItem('installedApps') || '[]');
        document.getElementById('appsStatusList').innerHTML = apps.map((a, i) => 
            `<div class="info-card">#${i+1} - ${a.name} (${a.id})</div>`
        ).join('');
    }

    // åˆ†é åˆ‡æ›
    function showTab(id) {
        document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        const activeTab = Array.from(document.querySelectorAll('.tab')).find(t => t.innerText.toLowerCase().includes(id) || (id==='editor' && t.innerText==='ç·¨è¼¯å™¨'));
        if(activeTab) activeTab.classList.add('active');
    }

    window.onload = initRoot;
</script>

</body>
</html>
