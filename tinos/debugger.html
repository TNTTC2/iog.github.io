<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Root Debugger</title>
    <style>
        :root {
            --bg: #000000;
            --card: #121212;
            --primary: #ff3b30;
            --text: #ffffff;
            --code: #32d74b;
            --accent: #0a84ff;
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: -apple-system, system-ui, sans-serif;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        #mainContent {
            width: 90%;
            max-width: 650px;
            background: var(--card);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 0 30px rgba(255, 59, 48, 0.2);
            margin: 20px;
        }

        .header-title {
            color: var(--primary);
            text-align: center;
            margin-top: 0;
            font-size: 22px;
            font-weight: 800;
            border-bottom: 1px solid #333;
            padding-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .editor-box {
            margin-top: 20px;
            max-height: 60vh;
            overflow-y: auto;
            padding-right: 5px;
        }

        /* 滾動條樣式 */
        .editor-box::-webkit-scrollbar { width: 5px; }
        .editor-box::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }

        .key-group {
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.03);
            padding: 12px;
            border-radius: 12px;
            border: 1px solid #222;
        }

        .key-name {
            color: var(--accent);
            font-size: 11px;
            font-family: 'SFMono-Regular', Consolas, monospace;
            margin-bottom: 8px;
            display: block;
            text-transform: uppercase;
        }

        textarea {
            width: 100%;
            background: #000;
            color: var(--code);
            border: 1px solid #333;
            border-radius: 8px;
            padding: 12px;
            font-family: 'SFMono-Regular', Consolas, monospace;
            font-size: 13px;
            box-sizing: border-box;
            resize: vertical;
            outline: none;
            line-height: 1.4;
        }

        textarea:focus { border-color: var(--accent); }

        .action-bar {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 12px;
            margin-top: 25px;
        }

        .btn {
            padding: 15px 5px;
            border: none;
            border-radius: 12px;
            font-weight: bold;
            cursor: pointer;
            color: white;
            font-size: 14px;
            transition: 0.2s;
        }

        .btn-reset { background: #3a3a3c; }
        .btn-apply { background: #34c759; color: black; }
        .btn-respring { background: #ff3b30; }

        .btn:active { transform: scale(0.95); opacity: 0.8; }
        
        .status-tip {
            text-align: center;
            font-size: 11px;
            color: #666;
            margin-top: 15px;
        }
    </style>
</head>
<body>

    <div id="mainContent">
        <h2 class="header-title">Root Debugger</h2>
        
        <div id="editor" class="editor-box">
            </div>

        <div class="action-bar">
            <button class="btn btn-reset" onclick="initEditor()">重設</button>
            <button class="btn btn-apply" onclick="saveData()">套用</button>
            <button class="btn btn-respring" onclick="respring()">重刷</button>
        </div>
        
        <div class="status-tip">警告：修改核心數據可能導致系統無法啟動</div>
    </div>

    <script>
        // 定義要管理的所有系統暫存 Key
        const TARGET_KEYS = [
            'userPasscode',
            'installedApps',
            'currentTheme',
            'homeWallpaper',
            'lockWallpaper',
            'screensaverPattern',
            'screensaverTimeout'
        ];

        // 頁面加載時自動初始化
        window.onload = function() {
            initEditor();
        };

        // 讀取暫存並顯示 (重設功能)
        function initEditor() {
            const container = document.getElementById('editor');
            container.innerHTML = '';

            TARGET_KEYS.forEach(key => {
                // 直接從 localStorage 抓取
                const val = window.localStorage.getItem(key) || "";
                
                const div = document.createElement('div');
                div.className = 'key-group';
                div.innerHTML = `
                    <span class="key-name">KERNEL_PATH: /SYSTEM_STORAGE/${key}</span>
                    <textarea id="field-${key}" rows="4" spellcheck="false">${val}</textarea>
                `;
                container.appendChild(div);
            });
            console.log("Root Debugger: Data Loaded.");
        }

        // 套用變更 (Apply)
        function saveData() {
            if(!confirm("確定要將當前編輯的內容強制寫入系統暫存？")) return;

            TARGET_KEYS.forEach(key => {
                const textarea = document.getElementById(`field-${key}`);
                if (textarea) {
                    window.localStorage.setItem(key, textarea.value);
                }
            });
            alert("✅ 系統暫存已更新");
        }

        // 重刷 (Respring)
        function respring() {
            // 跳轉至你指定的重載頁面
            window.location.href = './install.html';
        }
    </script>
</body>
</html>
