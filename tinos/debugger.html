<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AIOS | System Root</title>
    <style>
        :root { --primary: #007aff; --bg: #000; --card-bg: #1c1c1e; --text: #fff; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 10px; overflow: hidden; }
        
        /* 1. Checking Screen (Full Cover) */
        #check-screen { position: fixed; inset: 0; background: #000; z-index: 10000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .spinner { width: 30px; height: 30px; border: 3px solid #333; border-top-color: var(--primary); border-radius: 50%; animation: spin 0.8s linear infinite; margin-bottom: 15px; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* 2. Security Auth Screen */
        #auth-overlay { position: fixed; inset: 0; background: var(--bg); z-index: 9999; display: none; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        .auth-input { background: #2c2c2e; border: 2px solid #444; color: white; padding: 15px; border-radius: 12px; width: 200px; font-size: 24px; text-align: center; letter-spacing: 5px; margin-bottom: 20px; outline: none; }

        /* 3. Layout Manager Modal */
        #layout-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 9000; display: none; padding: 20px; align-items: center; justify-content: center; }
        .modal-content { background: #1c1c1e; width: 90%; max-width: 350px; border-radius: 15px; padding: 20px; border: 1px solid #333; }
        .sort-item { display: flex; align-items: center; justify-content: space-between; background: #2c2c2e; padding: 10px; margin-bottom: 5px; border-radius: 8px; font-size: 13px; }
        .sort-item span { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 150px; }

        /* Main UI (Hidden by default) */
        #main-ui { display: none; }
        .card { max-width: 1000px; margin: 0 auto; background: var(--card-bg); padding: 15px; border-radius: 16px; border: 1px solid #333; height: 95vh; display: flex; flex-direction: column; }
        .toolbar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .quick-bar { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 10px; }
        .quick-bar input { background: #000; border: 1px solid #333; color: white; padding: 8px; border-radius: 6px; font-size: 11px; width: 100%; box-sizing: border-box; }
        
        textarea { flex-grow: 1; width: 100%; font-family: "SF Mono", monospace; background: #000; color: #32d74b; padding: 10px; border-radius: 10px; border: 1px solid #333; font-size: 11px; resize: none; }

        .storage-tags { display: flex; flex-wrap: wrap; gap: 5px; margin-top: 10px; max-height: 80px; overflow-y: auto; }
        .tag { background: #2c2c2e; padding: 5px 10px; border-radius: 6px; font-size: 10px; cursor: pointer; border: 1px solid #333; }
        .tag.active { border-color: var(--primary); color: var(--primary); }

        .actions { margin-top: 15px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        button { padding: 12px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; }
        .btn-layout { background: var(--primary); color: white; font-size: 11px; padding: 5px 10px; }
        .btn-save { background: #32d74b; color: #000; }
        .btn-respring { background: #ff9f0a; color: #000; text-decoration: none; text-align: center; display: flex; align-items: center; justify-content: center; font-size: 14px; }
    </style>
</head>
<body>

    <div id="check-screen">
        <div class="spinner"></div>
        <div style="color:#666; font-size: 12px; letter-spacing: 1px;">VERIFYING INTEGRITY...</div>
    </div>

    <div id="auth-overlay">
        <h2 style="margin-bottom:10px;">üîê Root Lock</h2>
        <p style="color:#888; font-size: 12px; margin-bottom: 20px;">Verification required: devicePasscode</p>
        <input type="password" id="passInput" class="auth-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autofocus>
        <button onclick="checkAuth()" style="background:var(--primary); color:white; width:100px;">Unlock</button>
    </div>

    <div id="layout-modal">
        <div class="modal-content">
            <h3 style="margin-top:0">Manage Order</h3>
            <div id="sort-list"></div>
            <button onclick="closeLayout()" style="width:100%; margin-top:15px; background:#333; color:white;">Apply & Close</button>
        </div>
    </div>

    <div id="main-ui" class="card">
        <div class="toolbar">
            <h2 style="margin:0">Root Debugger</h2>
            <button class="btn-layout" onclick="openLayout()">Manage Layout</button>
        </div>
        
        <div class="quick-bar">
            <div class="field"><input type="text" id="sys-pass" placeholder="Passcode"></div>
            <div class="field"><input type="text" id="sys-theme" placeholder="Theme"></div>
            <div class="field"><input type="text" id="sys-wall" placeholder="Wallpaper"></div>
        </div>

        <textarea id="jsonEditor" spellcheck="false"></textarea>
        <div id="storage-tags" class="storage-tags"></div>
        
        <div class="actions">
            <button class="btn-save" onclick="saveData()">üíæ Commit</button>
            <a href="index.html" class="btn-respring">üîÑ Respring</a>
        </div>
    </div>

    <script>
        const editor = document.getElementById('jsonEditor');
        let currentTargetKey = 'installedApps';

        // 1. Correct Key Check
        window.onload = function() {
            setTimeout(() => {
                const pass = localStorage.getItem('devicePasscode'); // Correct Key
                document.getElementById('check-screen').style.display = 'none';

                if (pass && pass !== "") {
                    document.getElementById('auth-overlay').style.display = 'flex';
                } else {
                    showMain();
                }
            }, 800);
        };

        function checkAuth() {
            if (document.getElementById('passInput').value === localStorage.getItem('devicePasscode')) {
                document.getElementById('auth-overlay').style.display = 'none';
                showMain();
            } else {
                alert("Incorrect Passcode");
            }
        }

        function showMain() {
            document.getElementById('main-ui').style.display = 'flex';
            refreshTags();
            loadKey('installedApps');
            document.getElementById('sys-pass').value = localStorage.getItem('devicePasscode') || '';
            document.getElementById('sys-theme').value = localStorage.getItem('currentTheme') || '';
            document.getElementById('sys-wall').value = localStorage.getItem('homeWallpaper') || '';
        }

        // 2. Order Management
        function openLayout() {
            document.getElementById('layout-modal').style.display = 'flex';
            renderSortList();
        }

        function renderSortList() {
            const apps = JSON.parse(localStorage.getItem('installedApps') || "[]");
            const list = document.getElementById('sort-list');
            list.innerHTML = "";
            apps.forEach((app, i) => {
                const item = document.createElement('div');
                item.className = 'sort-item';
                item.innerHTML = `<span>${app.name}</span> <div>
                    <button onclick="move(${i},-1)">‚ñ≤</button>
                    <button onclick="move(${i},1)">‚ñº</button>
                </div>`;
                list.appendChild(item);
            });
        }

        function move(idx, dir) {
            let apps = JSON.parse(localStorage.getItem('installedApps'));
            const nIdx = idx + dir;
            if (nIdx >= 0 && nIdx < apps.length) {
                [apps[idx], apps[nIdx]] = [apps[nIdx], apps[idx]];
                localStorage.setItem('installedApps', JSON.stringify(apps));
                renderSortList();
                if (currentTargetKey === 'installedApps') loadKey('installedApps');
            }
        }

        function closeLayout() { document.getElementById('layout-modal').style.display = 'none'; }

        // 3. Data Logic
        function refreshTags() {
            const container = document.getElementById('storage-tags');
            container.innerHTML = "";
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                const tag = document.createElement('span');
                tag.className = 'tag' + (key === currentTargetKey ? ' active' : '');
                tag.innerText = key;
                tag.onclick = () => loadKey(key);
                container.appendChild(tag);
            }
        }

        function loadKey(key) {
            currentTargetKey = key;
            const val = localStorage.getItem(key);
            try { editor.value = JSON.stringify(JSON.parse(val), null, 4); }
            catch(e) { editor.value = val; }
            refreshTags();
        }

        function saveData() {
            localStorage.setItem(currentTargetKey, editor.value);
            localStorage.setItem('devicePasscode', document.getElementById('sys-pass').value);
            localStorage.setItem('currentTheme', document.getElementById('sys-theme').value);
            localStorage.setItem('homeWallpaper', document.getElementById('sys-wall').value);
            alert("System Modified Successfully.");
        }
    </script>
</body>
</html>
