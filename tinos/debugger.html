<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Root Debugger</title>
    <style>
        :root {
            --bg: #000000;
            --card: #1c1c1e;
            --primary: #ff3b30;
            --text: #ffffff;
            --code: #32d74b;
            --accent: #0a84ff;
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: -apple-system, system-ui, sans-serif;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
        }

        .container {
            width: 100%;
            max-width: 600px;
            background: var(--card);
            border-radius: 20px;
            border: 1px solid #2c2c2e;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }

        /* æ¨™é¡Œæ¬„ */
        .header {
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid #2c2c2e;
        }

        .header h2 {
            margin: 0;
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: 2px;
            font-size: 18px;
        }

        /* åˆ†é å°è¦½åˆ— (å°æ‡‰ä½ çš„è¨­è¨ˆåœ–é¸å–®) */
        .nav-tabs {
            display: flex;
            background: #121212;
            overflow-x: auto;
            border-bottom: 1px solid #2c2c2e;
        }

        .tab {
            flex: 1;
            padding: 15px 10px;
            text-align: center;
            font-size: 13px;
            color: #8e8e93;
            cursor: pointer;
            white-space: nowrap;
        }

        .tab.active {
            color: var(--text);
            border-bottom: 2px solid var(--primary);
            background: var(--card);
        }

        /* å…§å®¹å€åŸŸ */
        .content-section {
            display: none;
            padding: 20px;
            height: 60vh;
            overflow-y: auto;
        }

        .content-section.active {
            display: block;
        }

        /* ç·¨è¼¯å™¨åˆ†é æ¨£å¼ */
        .key-group {
            background: rgba(255,255,255,0.03);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 15px;
            border: 1px solid #333;
        }

        .key-label {
            color: var(--accent);
            font-size: 11px;
            font-family: monospace;
            margin-bottom: 8px;
            display: block;
        }

        textarea {
            width: 100%;
            background: #000;
            color: var(--code);
            border: 1px solid #444;
            border-radius: 8px;
            padding: 10px;
            font-family: monospace;
            font-size: 13px;
            resize: vertical;
        }

        /* åº•éƒ¨æŒ‰éˆ•æ¬„ */
        .footer-actions {
            padding: 20px;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            background: #121212;
        }

        .btn {
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            font-size: 14px;
        }

        .btn-reset { background: #3a3a3c; color: white; }
        .btn-apply { background: #32d74b; color: black; }
        .btn-respring { background: var(--primary); color: white; }

        /* æ¸…å–®æ¨£å¼ (Apps/Wallpaper ç®¡ç†) */
        .list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: #2c2c2e;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .badge {
            background: var(--primary);
            padding: 2px 8px;
            border-radius: 5px;
            font-size: 10px;
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="header">
            <h2>Root Debugger</h2>
        </div>

        <div class="nav-tabs">
            <div class="tab active" onclick="switchTab('tab-editor')">ç·¨è¼¯å™¨</div>
            <div class="tab" onclick="switchTab('tab-apps')">Appsç®¡ç†</div>
            <div class="tab" onclick="switchTab('tab-wallpaper')">Wallpaperç®¡ç†</div>
            <div class="tab" onclick="switchTab('tab-menu')">é¸å–®</div>
        </div>

        <div id="tab-editor" class="content-section active">
            <div id="editor-container">
                </div>
        </div>

        <div id="tab-apps" class="content-section">
            <p style="font-size: 12px; color: #8e8e93;">å·²åµæ¸¬åˆ°å®‰è£çš„æ‡‰ç”¨ç¨‹å¼ï¼š</p>
            <div id="apps-list">
                <div class="list-item"><span>System Core</span> <span class="badge">Running</span></div>
                <div id="dynamic-apps-count"></div>
            </div>
        </div>

        <div id="tab-wallpaper" class="content-section">
            <div class="key-group">
                <span class="key-label">HOME_WALLPAPER_DATA</span>
                <div id="wallpaper-preview" style="height: 100px; background: #000; border: 1px dashed #555; margin-bottom: 10px; display: flex; align-items: center; justify-content: center; font-size: 12px; color: #666;">
                    Preview Loading...
                </div>
                <button class="btn btn-reset" style="width: 100%; font-size: 12px;" onclick="clearWallpaper()">æ¸…é™¤æ¡Œå¸ƒæš«å­˜</button>
            </div>
        </div>

        <div id="tab-menu" class="content-section">
            <div class="list-item" onclick="switchTab('tab-editor')">ğŸ› ï¸ é€²å…¥æ•¸æ“šç·¨è¼¯æ¨¡å¼</div>
            <div class="list-item" onclick="switchTab('tab-apps')">ğŸ“¦ æ‡‰ç”¨ç¨‹å¼å°è£ç®¡ç†</div>
            <div class="list-item" onclick="switchTab('tab-wallpaper')">ğŸ–¼ï¸ ç³»çµ±ä½ˆæ™¯è³‡æº</div>
            <div class="list-item" style="opacity: 0.5;">âŒ¨ï¸ æŒ‡ä»¤ä¸»æ©Ÿ (æœªè¨­è¨ˆ)</div>
        </div>

        <div class="footer-actions">
            <button class="btn btn-reset" onclick="refreshData()">é‡è¨­</button>
            <button class="btn btn-apply" onclick="saveData()">å¥—ç”¨</button>
            <button class="btn btn-respring" onclick="respring()">é‡åˆ·</button>
        </div>
    </div>

    <script>
        const STORAGE_KEYS = ['userPasscode', 'installedApps', 'currentTheme', 'homeWallpaper', 'lockWallpaper'];

        function switchTab(id) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
            
            // æ‰¾åˆ°é»æ“Šçš„ Tab (å¦‚æœæ˜¯é»é¸å–®å…§çš„é …ç›®è·³è½‰)
            const activeTab = Array.from(document.querySelectorAll('.tab')).find(t => t.getAttribute('onclick').includes(id));
            if(activeTab) activeTab.classList.add('active');
            
            document.getElementById(id).classList.add('active');
        }

        function refreshData() {
            // 1. ç·¨è¼¯å™¨é‡è¨­
            const container = document.getElementById('editor-container');
            container.innerHTML = '';
            STORAGE_KEYS.forEach(key => {
                const val = localStorage.getItem(key) || "";
                container.innerHTML += `
                    <div class="key-group">
                        <span class="key-label">SYSTEM_ROOT_KEY: ${key}</span>
                        <textarea id="field-${key}" rows="4" spellcheck="false">${val}</textarea>
                    </div>
                `;
            });

            // 2. Apps ç®¡ç†æ›´æ–°
            const apps = JSON.parse(localStorage.getItem('installedApps') || '[]');
            document.getElementById('dynamic-apps-count').innerHTML = `
                <div class="list-item"><span>User Apps</span> <span class="badge" style="background: #0a84ff">${apps.length} Installed</span></div>
            `;

            // 3. Wallpaper é è¦½
            const wp = localStorage.getItem('homeWallpaper');
            const preview = document.getElementById('wallpaper-preview');
            if(wp && wp.startsWith('data:image')) {
                preview.innerHTML = `<img src="${wp}" style="max-height: 100%; border-radius: 5px;">`;
            } else {
                preview.innerHTML = "ç„¡è‡ªå®šç¾©æ¡Œå¸ƒæ•¸æ“š";
            }
        }

        function saveData() {
            if(!confirm("ç¢ºå®šå¥—ç”¨æ‰€æœ‰åˆ†é çš„æ›´æ”¹ï¼Ÿ")) return;
            STORAGE_KEYS.forEach(key => {
                const txt = document.getElementById(`field-${key}`);
                if(txt) localStorage.setItem(key, txt.value);
            });
            alert("âœ… æš«å­˜æ•¸æ“šå·²æ›´æ–°");
        }

        function clearWallpaper() {
            if(confirm("ç¢ºå®šåˆªé™¤æ¡Œå¸ƒæ•¸æ“šï¼Ÿ")) {
                localStorage.removeItem('homeWallpaper');
                localStorage.removeItem('lockWallpaper');
                refreshData();
            }
        }

        function respring() {
            window.location.href = './install.html';
        }

        window.onload = refreshData;
    </script>
</body>
</html>
